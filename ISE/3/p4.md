#####################################

ahora a otra cosa mariposa

#####################################

ahora el profe nos va a enseñar ansible

heamientas de gestion de la ocnfiguracion
se usa mucho en devops

nos permiten a partir de un fihero de texto y nos va a permii onfguar distintos servidores, es deir llevamos el servidor a un estado onoido

esto se llama Infrastructure as code IaC

otro muy usado es Puppet => este publica el devops anual review y la reerncia estandar de las indsutria

ansible solo neecsita ssh y python

el ordenado ranitiron de ansible neecsita tneer ssh sin contraseña y python

insalamos ansible ocn apt

todo lo anterior en ubuntu ocn ssh

la ocnfig esta en etc ansible

el fichero de hosts es muy importantes, esa es la que vamos a trabajr hoy
ahi vamos a deifnir los servidores que forman nuestra granja

el profe lo va a haer desde su mac para tener 3 equipos

en nuestro directorio home hay un .ansible arhcivo de config que tiene perdominancia sobre el de etc
si lo abimos podmeos modiicar el parametro inventory para decirle donde esta el ahciv hosts

añadismos a hosts debajo de ex 1
ubuise ansible_host=ip

ansible ubuise -m ping

ha fallado, aq ue se debe el eor? ha usado nuestro usuario,p lo que hay que indiarle el usuario que queremos
ansible ubuise -u david -m ping

ahora debeira salir

probamos ahora ocn ecntos

lo haecmos igual

lo de -u algo se puede ocnigurar el en host ponienso anisble_user=david despues de la ip en el arhivo hotst

lo prboemos sin la opion -u y debeira ir.

añadimos tambien el uburaid

para lanzarlo a todos

ansible all-m ping

creamos en hosts ocn oclleciones:

[unumtuservers]
ubuise
uburaid

[webservers]
ubuise
ecnise

con ansible ubuntuservers -m service -a "name=apache2 state=started"

para arreglar el poblema en centos al poner all ocnel httpd deinimos variables donde hemos deinidos los servidores
añadimos httpdService='apache2' alos ubuntu y httpdService='httpd' y en name ne lugar de usar apache2 usamos {{httpdService}}

y pobamos again el comando

imaginemos que queremos haer algo en remoto, pues usamos el modulo ocmmand

ansible all -m ocmmand -a "who"

imagnid que en lugar de eso queremos aoagar la maqina

ansible all -m ocmmand -a "shutdown -t now"

lo haecmos con el comando beocme

ansible all -b -m ocmmand -a "who"

ocmo nos ocnvertimos en orot sin contraseña? ocn el comanod sudoer
nos conectamos a una de las maquinas
en etc sudoers
en entos en ese arhivo esta el ocmando nopasswd
o usar wheel o
prueba ALL=(ALL) lo que sea

por ejemplo queremos apagar los servidores web

ansible webservers -b -m command -a "shutdown -t now"
